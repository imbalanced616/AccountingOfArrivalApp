Правки приложения AccountingOfArrivalApp
========================================

Изменения за 13.06.23
---------------------
**Добавил:**
- На странице регистрации (`RegistrationPage.xaml` и `RegistrationPage.xaml.cs`) и в личном кабинете (`PagePersonalAccount.xaml` и `PagePersonalAccount.xaml.cs`):
- Проверку на вводимую дату рождения.
- На странице контрагентов (`PageCounterparties.xaml` и `PageCounterparties.xaml.cs`):
- Фильтр по правовой форме контрагента.
- Иконку для приложения;
- Иконки для контекстного меню:
- Добавление (`Add.ico`);
- Изменение (`Edit.ico`);
- Удаление (`Delete.ico`);
- Обновление (`Update.ico`);
- Фильтр (`Filter.ico`);
- Сортировка (`Sort.ico`);
- Загрузка (`Load.ico`);
- Очистить (`Clear.ico`);
- Распределить (`Distribute.ico`);
- Печать (`Print.ico`);
- Личный кабинет (`PersonalAccount.ico`);
- Выход (`SignOut.ico`).

**Исправил:**
- Ошибки.

Изменения за 08.06.23
---------------------
**Добавил:**
- В папку `Resources`:
- Шаблон Word для вывода приходной накладной.
- На странице поступлений (`PageArrivals.xaml`):
- В контестное меню пункты:
- *"Экспорт"*: Содержит пункты с различными вариантами экспорта;
- *"в Word"*: Экспорт выбранной накладной в шаблон Word;
- *"в Excel"*: Экспорт выбранной накладной в новый файл Excel;
- *"в PDF"*: Экспорт выбранной накладной в формат PDF.
- На странице поступлений (`PageArrivals.xaml.cs`):
- Событие при экспорте накладной в Word:
- Проверку, что поступление выбранно.

Изменения за 07.06.23
---------------------
**Добавил:**
- Для класса пользователей (`Users.cs`):
- Метод, возвращающий отсортированный список пользователей.
- На странице пользователей (`PageUsers.xaml` и `PageUsers.xaml.cs`):
- Сортировку по логину и ФИО.
- Подсчёт количества записей состава номенклатуры на страницах:
- Добавления/изменения поступления (`AddEditPageArrival.xaml` и `AddEditPageArrival.xaml.cs`);
- Просмотра состава поступления (`PageArrivalComposition.xaml` и `PageArrivalComposition.xaml.cs`).
- На странице просмотра состава поступления (`PageArrivalComposition.xaml` и `PageArrivalComposition.xaml.cs`):
- Фильтр по типу материала.
- Для класса движений (`Movement.cs`):
- Метод, возвращающий отфильтрованный список движений по складу.
- На странице движений (`PageMovement.xaml` и `PageMovement.xaml.cs`):
- Фильтр по складу.

**Исправил:**
- Для класса материалов (`Materials.cs`):
- Метод добавления (значение `NULL` при отсутствии шаблона).
- На странице добавления номенклатуры (`AddEditPageNomenclature.xaml` и `AddEditPageNomenclature.xaml.cs`):
- Корректное отображение чертёжного номера, в зависимости от выбранного типа материала.

Изменения за 06.06.23
---------------------
**Добавил:**
- Страницу добавления/изменения пользователя (`AddEditPageUser.xaml` и `AddEditPageUser.xaml.cs`)
- Для класса пользователей (`Users.cs`):
- Интерфейс `INotifyPropertyChanged`;
- Метод для получения нового пользователя;
- Метод для отмены изменения пользователя.
- Для класса пользователя (`User.cs` (*Singleton*)):
- Интерфейс `INotifyPropertyChanged`;
- Свойство подсчитывающее возраст;
- Метод для обновления данных пользователя.
- Для страницы личного кабинета (`PagePersonalAccount.xaml` и `PagePersonalAccount.xaml.cs`):
- Удаление аккаунта;
- Возраст пользователя.
- Для страницы пользователей (`PageUsers.xaml.cs`):
- Добавление/изменение пользователя;
- Изменение авторизированного аккаунта;
- Удаление авторизированного аккаунта.

**Исправил:**
- Добавление контрагента на странице `AddEditPageCounterparty`.

Изменения за 05.06.23
---------------------
**Добавил:**
- В класс пользователей (`Users.cs`):
- Свойсва возраста и типа возраста;
- Методы:
- Вывод списка пользователей;
- Вывод списка пользователей с фильтром по типу;
- Вывод списка пользователей по поиску.
- Страницу пользователей (`PageUsers.xaml` и `PageUsers.xaml.cs`):
- Вывод списка пользователей;
- Поиск;
- Вывод количества записей;
- Фильтрацию списка по типу пользователя;
- Удаление пользователя и данных привязанных к его `id`.
- На странице личного кабинета
(`PagePersonalAccount.xaml` и `PagePersonalAccount.xaml.cs`) и главной странице (`PageLobby.xaml` и `PageLobby.xaml.cs`):
- Кнопку для перехода на страницу пользователей, если тип авторизированного пользователя *"Администратор"*.
- На странице распределения поступлений (`PageDistributions.xaml.cs`):
- Уведомляющий пункт в фильрации по номеру поставки, при отсутствии поставки.

**Заменил:**
- В классе движений поступлений (`Movement.xaml.cs`):
- Методы:
- Обновление движениий на удаление при удалении пользователя;
- Удаление движений при удалении склада на более простую реализацию.

**Исправил:**
- Изменение поставки (`AddEditPageArrival.xaml.cs`);
- Отсутствие оповещения *"Данные удалены!"* при отмене удаления на страницах:
- Номенклатура (`PageNomenclature.xaml.cs`);
- Склады (`PageWarehouses.xaml.cs`);
- Контрагенты (`PageCounterparties.xaml.cs`);
- Поступления (`PageArrivals.xaml.cs`).

Изменения за 31.05.23
---------------------
**Добавил:**
- Страницу просмотра позиций накладных для распределения (`PageDistributions.xaml` и `PageDistributions.xaml.cs`):
- Вывод списка позиций накладных для распределения через метод;
- Поиск по всем полям в `DataGrid`;
- Распределение позиции: Открытие страницы с распределением состава накладной и выбранным элементом из предыдущий страницы;
- Обновление данных;
- Фильтрация:
- По номеру поставки;
- По типу материала;
- По распределению.
- В классе состава накладной (`CompositionsOfInvoice.cs`):
- Методы:
- Вывод составов из всех накладных;
- Вывод составов из всех накладных с фильтрацией:
- По номеру поставки;
- По типу материала;
- По распределению.
- Вывод составов из всех накладных по поиску.
- На странице распределения поставки (`AddEditMovementDistribution.xaml.cs`):
- Конструктор при распределении позиции из страницы просмотра позиций накладных для распределения (`PageDistributions.xaml` и `PageDistributions.xaml.cs`);
- Возврат *"Назад"* в зависимости от предыдущий страницы.
- На странице меню (`PageLobby.xaml` и `PageLobby.xaml.cs`):
- Кнопку перехода на страницу просмотра позиций накладных для распределения;
- Отображение кнопок взависимости от типа авторизованного пользователя:
- Администратор: видит все кнопки;
- Кладовщик: видит кнопку с переходом на страницу просмотра позиций накладных для распределения.

Изменения за 30.05.23
---------------------
**Исправил ошибки:**
- На странице личного кабинета (`PagePersonalAccount.xaml.cs`): Заменил множество условных конструкций на конструкцию `switch/case`;
- Убрал ненужные сортировки `DataGrid` на страницах:
- Номенклатуры (`PageNomenclature.xaml` и `PageNomenclature.xaml.cs`);
- Складов (`PageWarehouses.xaml` и `PageWarehouses.xaml.cs`);
- Контрагентов (`PageCounterparties.xaml` и `PageCounterparties.xaml.cs`);
- Хранения материалов (`PageStorage.xaml` и `PageStorage.xaml.cs`);
- Поступлений (`PageArrivals.xaml` и `PageArrivals.xaml.cs`).
- Убрал ненужный метод сортировки у классов:
- Материалов (`Materials.cs`);
- Складов (`Warehouses.cs`);
- Хранения материалов (`Storage.cs`).
- Заменил проверки типа пользователя по названию на проверки по `id`.

**Добавил:**
- Страницу просмотра движений поступления (`PageMovements.xaml` и `PageMovements.xaml.cs`):
- Вывод списка движений с поступлением через метод с запросом;
- Поиск по всем полям в `DataGrid`;
- Обновление данных.
- В классе авторизированного пользователя (`User.cs`):
- `id` типа пользователя, для проверки и дальнейших действий.
- В классе материалов (`Materials.cs`):
- Метод `FirstOrDefault` для нахождения материала по `id` через запрос;
- Метод `FindDuplicate` для нахождения существующего материала по номеру чертежа;
- Метод `Single` для взятия `id` из БД по названию, номеру чертежа и типу.
- В классе типов материалов (`Types.cs`):
- Метод `FirstOrDefault` для нахождения типа по `id` через запрос.
- В классе складов (`Warehouses.cs`):
- Метод `FirstOrDefault` для нахождения склада по `id` через запрос.

Изменения за 29.05.23
---------------------
**Убрал:**
- В классе движения (`Movement.cs`): Не используемый интерфейс
`INotifyPropertyChanged`.

**Исправил:**
- Класс движения (`Movement.cs`): Метод добавления/редактирования/удаления (добавлялись строки с пустым количеством распределения).

**Изменил:**
- Класс движения (`Movement.cs`): Получение `id` из `get` вместо присваивания из метода добавления/редактирования/удаления.

**Добавил:**
- В классе хранения (`Storage.cs`): В методе, выводящий контекстный список, вывод распределённого количества материала из БД;
- В классе состава накладной (`CompositionsOfInvoice.cs`):
- Свойство (`DifferenceQuantity`), подсчитывающее оставшееся количества материала для распределения;
- `OnPropertyChanged` для нового свойства (`DifferenceQuantity`), по изменению распределённого количества материала из состава накладной (`QuantityDistributed`).
- На странице распределения (`AddEditMovementDistribution.xaml` и `AddEditMovementDistribution.xaml.cs`):
- Подсчёт оставшегося количества для распределения;
- Проведение движение для хранений и закрытие поступления (галочка для поля `DistributedInvoice` у накладной).

Изменения за 26.05.23
---------------------
**Добавил:**
- В классе движений (`Movement.cs`) метод для добавления/изменения/удаления движения;
- На странице распределения (`AddEditMovementDistribution.xaml` и `AddEditMovementDistribution.xaml.cs`):
- Обновление распределённого количества материалов;
- В `ComboBox` материала:
- Подсветку красным цветом не распределённого материала и зелёный распределённого;
- Распределённое количество/Количество для распределения.
- Добавления/изменения/удаления движения.

**Исправил:**
- В класс хранения (`Storage.cs`) поместил поле для хранения распределённого товара, которое было в классе движений (`Movement.cs`);
- На странице распределения (`AddEditMovementDistribution.xaml` и `AddEditMovementDistribution.xaml.cs`):
- Вывод в `DataGrid` списка хранения (`Storage`) вместо движений (`Movement`);

**Заменил:**
- Циклы с подсчётом суммы поставки на метод `LINQ` `.Sum()`.

**Убрал:**
- Методы для подсчёта суммы поставки через цикл.

Изменения за 25.05.23
---------------------
**Добавил:**
- На странице поступлений (`PageArrivals.xaml.cs`):
- Если тип вторизированного пользователя *"Администратор"* или *"Кладовщик"*, то:
- В `DataGrid` добавляется столбец *"Распределение"* с `CheckBox` (Для отметки распределения поступления);
- В контекстное меню добавляется пункт *"Распределить"*, для перехода на страницу распределения поставки с поступления, если поставка не распределена.
- На странице распределения поступления (`AddEditMovementDistribution.xaml` и `AddEditMovementDistribution.xaml.cs`):
- Описал размётку страницы (`xaml`);
- Выбор материала и требуемое количество для распределения (`xaml` и `cs`);
- Добавление в `DataGrid` записи с распределением.
- В классе движения (`Movement.cs`):
- Количество материала хранящегося на складе;
- Метод, возвращаемый список движений по составу поставки.

**Изменил:**
- В классе `ClassHelper.cs` описал методы для быстрого редактирования ячеек `DataGrid`, которые повторялись на 3-ёх страницах добавления/редактирования (`AddEditPageArrival.xaml.cs`, `AddEditPageNomenclature.xaml.cs` и `AddEditMovementDistribution.xaml.cs`);

Изменения за 24.05.23
---------------------
**Добавил:**
- Методы для классов:
- Состав приходной накладной (`CompositionsOfInvoice.cs`):
- Добавление/редактирование;
- Удаление.
- Приходные накладные (`InvoicesOnArrival.cs`):
- Подсчёт текущей суммы поставки на основе переданного списка состава накладной (для динамического изменения суммы при добавлении поставки).

**Исправил:**
- На странице добавления/изменения поставки (`AddEditPageArrival.xaml` и `AddEditPageArrival.xaml.cs`):
- Вывод суммы поставки и суммы состава в `DataGrid`;
- Оставшиеся изменения состава при отмене операции;
- Добавление поставки.

Изменения за 23.05.23
---------------------
**Обновил:**
- Модель данных из базы данных.

**Добавил:**
- Класс: Движения (`Movement.cs`);
- Методы для класса:
- Возвращающий список;
- Обновляющий `idWarehouse` у записей при удалении склада на `null`.
- Страницу: Движения
(`Movement.xaml` и `Movement.xaml.cs`).

**Убрал:**
- Метод у класса хранения (`Storage.cs`), который обновлял `idWarehouse` у записей при удалении склада на `null`, т.к. он больше не связан со складами;
- Избыточные циклы для получения виртуальных экземпляров различных классов.

**Реализовал:**
- Интерфейс `INotifyPropertyChanged` у классов:
- Приходные накладные (`InvoicesOnArrival.cs`): для обновления итоговой суммы прихода в привязках `Binding`;
- Состав приходной накладной (`CompositionsOfInvoice.cs`): для саморасчитываемой суммы по обновлению свойств количества (`Quantity`) и цены за единицу (`PricePerUnit`).
- Получение виртуального экземпляра привязанного класса у классов:
- Хранение материалов (`Storage.cs`): Склад (`Warehouse`) и Материал (`Material`);
- Материалы (`Materials.cs`): Тип материала (`Type`);
- Движение материалов (`Movement.cs`): Склад (`Warehouse`), Состав накладной (`Composition`) и Кладовщик (`User`);
- Иерархия материалов (`Hierarchy.cs`): Родительский материал (`MaterialParent`) и Дочерний материал (`MaterialChild`);
- Состав приходной накладной (`CompositionsOfInvoice.cs`): Материал (`Materials`).

Изменения за 22.05.23
---------------------
**Добавил:**
- Методы:
- Для класса накладных (`InvoicesOnArrival.cs`): при удалении пользователя заменяет `id` на `null`;
- Для класса хранения (`Storage.cs`): движение материалов при добавлении накладной.
- Проверку при добавлении накладной (в составе должна быть хотя бы одна запись);
- Сортировку по поставщику и менеджеру для накладных;
- Удаление накладных.

**Переделал:**
- Базу данных:
- Для номенклатуры (`Nomenclature`) добавил таблицу `Movement`, которая отвечает за движение товара на складе;
- Для приходных накладных (`AccountingOfArrival`) убрал склад у состава накладной, для накладной добавил поле `bool` для определения распределения материалов из накладной по складам.

Изменения за 19.05.23
---------------------
**Исправил:**
- В базе данных учёта поставок (`AccountingOfArrival`) склад из накладной переместил в состав накладной для для прибытия материалов на разные склады;
- При регистрации фиксированный `id` типа пользователя заменил на `id`, взятый из базы данных с названием типа *"Пользователь"*.

**Изменил:**
- Модель базы данных в приложении на обновлённую;
- Два разных события с добавлением и редактированием объединил в одно с проверкой на заголовок контекстного меню у страниц:
- Номенклатура (`PageNomenclature.xaml` и `PageNomenclature.xaml.cs`);
- Склады (`PageWarehouses.xaml` и `PageWarehouses.xaml.cs`);
- Контрагенты (`PageCounterparties.xaml` и `PageCounterparties.xaml.cs`).
- Название кнопки в главном меню *"Материалы"* на *"Номенклатура"*;
- Класс `InvoicesOnArrival.cs`.

**Добавил:**
- Страницу добавления/редактирования поставки (`AddEditPageArrival.xaml` и `AddEditPageArrival.xaml.cs`)
- Функции к поставкам:
- Добавление/редактирование
- Обновление данных.

Изменения за 18.05.23
---------------------
**Добавил:**
- Методы:
- В поставке (`InvoicesOnArrival.cs`):
- Замена `idWarehouse` на `null`, при удалении склада;
- Замена `idCounterparty` на `null`, при удалении контрагента.
- В хранении (`Storage.cs`):
- Удаление записи, при удалении склада;
- Для склада (`Warehouses.cs`):
- Добавление/редактирование;
- Удаление по `id`.
- Страницы:
- Добавления/редактирования контрагента (`AddEditPageCounterparty.xaml` и `AddEditPageCounterparty.xaml.cs`);
- Добавления/редактирования склада (`AddEditPageWarehouse.xaml` и `AddEditPageWarehouse.xaml.cs`).
- Активация кнопок по клавишам:
- Для кнопок *"В главное меню"*, *"Назад"* и *"Отмена"* клавиша *Escape*;
- Для входа, регистрации, добавления/изменения клавиша *Enter*.
- Функции:
- К складам:
- Добавление/редактирование;
- Обновление данных;
- Сортировка (одним событием);
- Удаление.
- К контрагентам:
- Добавление/редактирование;
- Обновление данных;
- Сортировка (одним событием);
- Удаление.

**Изменил:**
- Проверку введёных полей (применил `StringBuilder`) на страницах:
- Авторизации (`LoginPage.xaml.cs`);
- Регистрации
(`RegistrationPage.xaml.cs`).

Изменения за 17.05.23
---------------------
**Исправил:**
- Добавление материала и иерархии к нему:
- Изменил SQL-команды с добавлением и редатированием в методе `AddOrUpdate` - теперь они возвращают статус выполненой команды (1 - добавление, 2 - редактирование), с помощью которого при добавлении/изменении материала выдаётся соответствующее сообщение;
- Изменил SQL-команду с редатированием в методе `AddOrUpdate`, чтобы заменялись все данные;
- Изменил `DataGridTemplateColumn` на `DataGridComboBoxColumn` в `DataGrid` состава материала;
- Добавил редактирование ячейки по двойному щелчку;
- Добавил проверки на вводимые данные.
- Фильтрацию на странице номенклатуры (`PageNomenclature.xaml.cs`) - при обновлении добавлялись новые такие же фильтры.

**Добавил:**
- Методы:
- Поиск для классов:
- Хранимые материалы (`Storage.cs`);
- Склады (`Warehouses`);
- Поступления (`InvoicesOnArrival`).
- Сортировка и фильтрация для класса хранения (`Storage`);
- Поиск и меняющееся количество строк на страницах:
- Хранимые материалы (`PageStorage.xaml` и `PageStorage.xaml.cs`);
- Склады (`PageWarehouses.xaml` и `PageWarehouses.xaml.cs`);
- Контрагенты (`PageCounterparties.xaml` и `PageCounterparties.xaml.cs`);
- Поступления (`PageArrival.xaml` и `PageArrival.xaml.cs`).
- В контекстном меню у `DataGrid` для страницы хранения (`PageStorage.xaml` и `PageStorage.xaml.cs`) обновление таблицы, сортировку и фильтрацию.

Изменения за 16.05.23
---------------------
**Исправил:**
- Убрал второе подключение;

**Добавил:**
- Классы:
- Материалы (`Materials.cs`);
- Склады (`Warehouses.cs`);
- Хранение (`Storage.cs`);
- Типы материалов (`Types.cs`);
- Иерархия (`Hierarchy.cs`).
- Для всех классов описал метод возвращающий список с названием класса;
- Для классов хранение и иерархия описал метод удаляющий запись по id материалу (для удаления материала);
- Для классов материалы и хранение описал методы: добавление/редактирование и удаление по `id`;
- Для класса материалов описал методы: сортировка, фильтрация, поиск.

**Дополнил:**
- Главное меню:
- Добавил:
- Миниатюру фотографии авторизованного пользователя;
- Контекстное меню для миниатюры (и двойное нажатие) с открытием личного кабинета и выхода из аккаунта, вместо кнопок.

Изменения за 15.05.23
---------------------
**Дополнил:**
- Личный кабинет:
- Дата рождения (с редактированием);
- Тип пользователя.

**Добавил:**
- Функции к номенклатуре (`PageNomenclature.xaml` и `PageNomenclature.xaml.cs`):
- Добавление номенклатуры с составом материала;
- Редактирование номенклатуры с составом материала;
- Сортировка (одним событием);
- Фильтрация (создание фильтров через `*.cs` на основе типов материалов);
- Удаление.

Изменения за 12.05.23
---------------------
**Исправил ошибки:**
- `StringFormat`;
- хранение фото у пользователя в классе;
- менеджер вместо *"второго"* поставщика.

**Добавил:**
- Редактирование пользователя в личном кабинете:
- Изменение полей по двойному нажатию, отмена изменений на *Escape*;
- Сохранение изменений на *Enter*;
- Загрузка фото по двойному клику по картинке;
- Очистка картинки на крестик в углу картинки (появляется при загруженной фотке).
